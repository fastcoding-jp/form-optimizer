$.fn.formOptimizer=function(e){var a=this
return a.$form=$(this),a.settings=$.extend({language_path:"./",language:"en_US",email_regexp:/^[-a-z0-9~!$%^&*_=+}{\'?]+(\.[-a-z0-9~!$%^&*_=+}{\'?]+)*@([a-z0-9_][-a-z0-9_]*(\.[-a-z0-9_]+)*\.(aero|arpa|biz|com|coop|edu|gov|info|int|mil|museum|name|net|org|pro|travel|mobi|[a-z][a-z])|([0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}))(:[0-9]{1,5})?$/i,tel_regexp:/^[0-9]{2,3}[0-9]{4}[0-9]{4}$/g,url_regexp:/(ftp|http|https):\/\/(\w+:{0,1}\w*@)?(\S+)(:[0-9]+)?(\/|\/([\w#!:.?+=&%@!\-\/]))?/g,zipcode_regexp:/^[0-9]{3}-?[0-9]{4}/g,date_regexp:/^[0-9]{4}\/(0[1-9]|1[0-2])\/(0[1-9]|[1-2][0-9]|3[0-1])$/g,time_regexp:/^([0-1]{1}[0-9]{1}|2[0-3]):[0-5]{1}[0-9]$/g,number_regexp:/^\d*$/g,required_text:!0,on_load:function(){}},e),a.init=function(){a.setClasses(),a.initHTML(),a.events()},a.setClasses=function(){a.$form.addClass("fo-optimized"),a.$form.find("input, select, textarea").addClass("fo-field"),a.$form.find("[type='email']").addClass("fo-email"),a.$form.find("[type='tel']").addClass("fo-tel"),a.$form.find("[type='url']").addClass("fo-url"),a.$form.find("[type='date']").addClass("fo-date"),a.$form.find("[type='time']").addClass("fo-time"),a.$form.find("[type='number']").addClass("fo-number"),a.$form.find("[type='radio']").addClass("fo-radio"),a.$form.find("[type='checkbox']").addClass("fo-checkbox"),a.$form.find("select").addClass("fo-select"),a.$form.find("textarea").addClass("fo-textarea"),a.$form.find(".fo-field").each(function(e){$(this).attr("fo-field-id",e)})},a.initHTML=function(){0==$("#fo-required-fields").length&&$("body").append('<div id="fo-required-fields">'+a.lang.required_fields+"<span></span></div>"),a.settings.required_text&&a.find(".fo-item.fo-required .fo-label").append('<span class="fo-required-text">'+a.lang.required_text+"</span>"),a.add_incomplete_button(),a.$form.find(".fo-region").length>0&&(a.$form.find(".fo-region").append('<option value="">'+a.lang.empty_field+"</option>"),a.lang.prefectures.forEach(function(e){a.$form.find(".fo-region").append('<option value="'+e.name+'">'+e.name+"</option>")}))},a.add_incomplete_button=function(){a.$form[0].submit_button=a.$form.find(".fo-submit")[0].outerHTML,a.$form.find(".fo-submit").clone().addClass("fo-submit-invalid").removeClass("fo-submit").appendTo(a.$form.find(".fo-submit").parent()),a.$form.find(".fo-submit").remove(),a.$form.find(".fo-submit-invalid").is("button")?a.$form.find(".fo-submit-invalid").html(a.lang.incomplete).attr("type","button"):a.$form.find(".fo-submit-invalid").html("").attr("value",a.lang.incomplete).attr("type","button")},a.events=function(){a.$form.find(".fo-field").each(function(){a.checkField($(this))}),a.$form.find(".fo-field").on("click keyup change",function(e){$(this).hasClass("fo-submit-invalid")||$(this).hasClass("fo-submit")||$(this).hasClass("fo-submit-button")||a.checkField($(this)),$(this).hasClass("fo-zipcode")&&($(this).hasClass("fo-invalid-value")||$.ajax({url:"https://maps.googleapis.com/maps/api/geocode/json?address="+$(this).val()+","+a.lang.country_code+"&language="+a.lang.id,type:"GET",success:function(e){if(e.results[0].address_components){var i=a.parse_address(e.results[0].address_components)
a.$form.find('.fo-region option[value="'+i.prefecture+'"]').prop("selected",!0),a.$form.find(".fo-address-1").val(i.city+a.lang.separator+i.ward+a.lang.separator+i.street),a.$form.find(".fo-region").trigger("click"),a.$form.find(".fo-address-1").trigger("click")}}}))})},a.parse_address=function(e){var a={prefecture:"",city:"",ward:"",street:""}
return e.forEach(function(e){e.types.forEach(function(i){"administrative_area_level_1"==i&&(a.prefecture=e.long_name),"locality"==i&&(a.city=e.long_name),("ward"==i||"administrative_area_level_2"==i||"locality"==i&&""==a.city)&&(a.ward=e.long_name),"sublocality"==i&&(a.street=e.long_name)})}),a},a.datepicker_support=function(e){var a=document.createElement("input")
a.setAttribute("type",e)
var i="not-a-correct-value"
return a.setAttribute("value",i),a.value!==i},a.checkField=function(e){a.checkFieldEmpty(e)?e.removeClass("fo-not-empty"):e.addClass("fo-not-empty"),e.parents(".fo-item").hasClass("fo-required")&&(e.hasClass("fo-not-empty")?e.parents(".fo-item").removeClass("fo-invalid-required"):e.parents(".fo-item").addClass("fo-invalid-required"))
var i=/[^]*/,t=e.val(),o=""
e.hasClass("fo-email")&&(o=a.lang.email.message,i=RegExp(a.settings.email_regexp)),e.hasClass("fo-url")&&(o=a.lang.url.message,i=RegExp(a.settings.url_regexp)),e.hasClass("fo-tel")&&(o=a.lang.tel.message,i=RegExp(a.settings.tel_regexp)),e.hasClass("fo-date")&&(o=a.lang.date.message,a.datepicker_support("date")||(i=RegExp(a.settings.date_regexp))),e.hasClass("fo-time")&&(o=a.lang.time.message,i=RegExp(a.settings.time_regexp)),e.hasClass("fo-number")&&(o=a.lang.number.message,i=RegExp(a.settings.number_regexp)),e.hasClass("fo-zipcode")&&(o=a.lang.zipcode.message,i=RegExp(a.settings.zipcode_regexp)),e.hasClass("fo-katakana")&&(o=a.lang.katakana.message,i=RegExp(/[\u30A0-\u30FF]+/g)),e.hasClass("fo-hiragana")&&(o=a.lang.hiragana.message,i=RegExp(/[\u3041-\u3096]+/g)),null==t.match(i)?e.addClass("fo-invalid-value"):e.removeClass("fo-invalid-value"),e.parents(".fo-item").hasClass("fo-invalid-required")||e.hasClass("fo-invalid-value")?e.addClass("fo-invalid-field"):e.removeClass("fo-invalid-field"),e.hasClass("fo-invalid-field")?e.parents(".fo-item").hasClass("fo-invalid-required")?e.hasClass("fo-invalid-value")&&0==e.parents(".fo-fields").find(".fo-error[fo-field-id='"+e.attr("fo-field-id")+"']").length&&e.parents(".fo-fields").find(".fo-errors").append('<div class="fo-error" fo-field-id="'+e.attr("fo-field-id")+'">'+o+"</div>"):e.hasClass("fo-invalid-value")&&(e.hasClass("fo-not-empty")&&0==e.parents(".fo-fields").find(".fo-error[fo-field-id='"+e.attr("fo-field-id")+"']").length?e.parents(".fo-fields").find(".fo-errors").append('<div class="fo-error" fo-field-id="'+e.attr("fo-field-id")+'">'+o+"</div>"):e.hasClass("fo-not-empty")||e.parents(".fo-fields").find(".fo-error[fo-field-id='"+e.attr("fo-field-id")+"']").remove()):e.parents(".fo-fields").find(".fo-error[fo-field-id='"+e.attr("fo-field-id")+"']").remove(),a.checkForm()},a.checkFieldEmpty=function(e){var i=!1
return e.hasClass("fo-radio")||e.hasClass("fo-checkbox")?0==a.$form.find("[name='"+e.attr("name")+"']:checked").length&&(i=!0):e.hasClass("fo-checkbox")?e.is(":checked")||(i=!0):0==e.val().length&&(i=!0),i},a.checkForm=function(){var e=a.$form.find(".fo-invalid-required").length
$("#fo-required-fields span").html(e+"/"+a.$form.find(".fo-required").length),a.$form.find(".fo-invalid-required").length>0?$("#fo-required-fields").fadeIn():$("#fo-required-fields").fadeOut()
var i=0
i+=a.$form.find(".fo-invalid-required").length,i+=a.$form.find(".fo-invalid-value.fo-not-empty").length,0==i?0==a.$form.find(".fo-submit").length&&(a.$form.find(".fo-submit-invalid").parent().append(a.$form[0].submit_button),a.$form.find(".fo-submit-invalid").hide()):(a.$form.find(".fo-submit").remove(),a.$form.find(".fo-submit-invalid").show()),a.settings.on_load()},$.ajax({url:a.settings.language_path+a.settings.language+".json",type:"GET",error:function(){alert("Error downloading Form Optimizer language file")},success:function(e){a.lang=e,a.$form.each(function(){a.init($(this))})}})}
